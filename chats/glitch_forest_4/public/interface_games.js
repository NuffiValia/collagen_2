var StateMap={canvas:{container:"canvas",props:[["mousedown","mousedown",""],["mousemove","mousemove",""],["mouseup","mouseup",""],["mousewheel","mousewheel",""],["keydown","emiter-keydown",""],["keyup","emiter-keyup",""]],methods:{mousewheel:function(){event.preventDefault(),this.$$("emiter-mousewheel-canvas").set(event.deltaY)},keyup:function(){var e=this.$$("emiter-keyup").prop;modules.keyup(e)},keydown:function(){var e=this.$$("emiter-keydown").prop;modules.keydown(e),!isMoveCamera||("KeyW"==e?(ctxTranslate[1]+=5,ctxTranslate[1]>0&&(ctxTranslate[1]=0),"edit"==mode&&this.$methods().renderAll(!1,{drawAreaPoints:!1})):"KeyS"==e?(ctxTranslate[1]-=5,ctxTranslate[1]<maxTranslate[1]&&(ctxTranslate[1]=maxTranslate[1]),"edit"==mode&&this.$methods().renderAll(!1,{drawAreaPoints:!1})):"KeyA"==e?(ctxTranslate[0]+=5,ctxTranslate[0]>0&&(ctxTranslate[0]=0),"edit"==mode&&this.$methods().renderAll(!1,{drawAreaPoints:!1})):"KeyD"==e&&(ctxTranslate[0]-=5,ctxTranslate[0]<maxTranslate[0]&&(ctxTranslate[0]=maxTranslate[0]),"edit"==mode&&this.$methods().renderAll(!1,{drawAreaPoints:!1})),this.$props("operationWith"))},mousedown:function(){var e=getCanvasPoint(event,this.parent.htmlLink);if(e[0]-=ctxTranslate[0],e[1]-=ctxTranslate[1],modules.mousedown(e),this.$$("emiter-mousedown-canvas").set(e),1===event.which){var t=this.$props("commonProps").area_1,s=this.$props("commonProps").isEndArea_1;if("common"==this.$props("operationWith"))!1===s?(s=endArea(t,e))?this.$props("commonProps").isEndArea_1=!0:t.push(e):(this.$props("commonProps").isMovePoint=isClickOnPoint(t,e),this.$props("commonProps").area_2=this.$props("commonProps").area_1.slice(0)),ctx.save(),ctx.translate(ctxTranslate[0],ctxTranslate[1]),drawAreaPoints(t,s),ctx.restore();else if(this.$props().sprites[this.$props("operationWith")]){this.$props().sprites[this.$props("operationWith")].mousedown(e,event,this)}}},mousemove:function(){var e=getCanvasPoint(event,canvas);if(e[0]-=ctxTranslate[0],e[1]-=ctxTranslate[1],this.$$("emiter-mousemove-canvas").set(e),"common"==this.$props("operationWith")){var t=this.$props("commonProps").isMovePoint;!1!==t&&"move"==this.$props("commonProps").scale_or_move&&(this.$methods().setPoint(e,t,"area_1"),this.$methods().renderAll())}else if(this.$props().sprites[this.$props("operationWith")]){var s=this.$props().sprites[this.$props("operationWith")];s.cursorOver_(e),s.mousemove(e,this,event)}},mouseup:function(){var e=getCanvasPoint(event,canvas);if(e[0]-=ctxTranslate[0],e[1]-=ctxTranslate[1],modules.mouseup(e),this.$$("emiter-mouseup-canvas").set(e),1===event.which)if("common"==this.$props("operationWith"))!1!==this.$props("commonProps").isMovePoint&&(this.$props("commonProps").isMovePoint=!1);else if(this.$props().sprites[this.$props("operationWith")]){this.$props().sprites[this.$props("operationWith")].mouseup(this,e)}}}},stateProperties:{operationWith:"common",commonProps:{area_1:[],area_2:[],isEndArea_1:!1,isMovePoint:!1,scale_or_move:"move",scale_asix:"xy",sprite_grid:!1},sprites:{},showBox:!0,showPoints:!1,warper:!1},stateMethods:{renderAll:function(e,t){ctx.save(),ctx.translate(ctxTranslate[0],ctxTranslate[1]),null==t?t={showBox:this.stateProperties.showBox,showPoints:this.stateProperties.showPoints,drawAreaPoints:!0}:(t.showBox=this.stateProperties.showBox,t.showPoints=this.stateProperties.showPoints,null==t.drawAreaPoints&&(t.drawAreaPoints=!0)),ctx.putImageData(saveImg,0,0);var s=this.stateProperties.operationWith,o=this.stateProperties.sprites;for(var r in renderAllTiles(),o)o[r].render(s,e,t);"common"==this.stateProperties.operationWith&&0!=t.drawAreaPoints&&drawAreaPoints(this.stateProperties.commonProps.area_1,this.stateProperties.commonProps.isEndArea_1),this.stateMethods.drawGrid(),ctx.restore()},drawGrid:function(){this.stateProperties.commonProps.sprite_grid&&drawSpriteGrid(this.stateProperties.commonProps.sprite_grid[0],this.stateProperties.commonProps.sprite_grid[1])},setAreas:function(e){this.stateProperties.commonProps.area_1=e.slice(0),this.stateProperties.commonProps.area_2=e.slice(0)},setPoint:function(e,t,s){this.stateProperties.commonProps[s][t][0]=e[0],this.stateProperties.commonProps[s][t][1]=e[1],e[2]&&(this.stateProperties.commonProps[s][t][2]=e[2])},startWarper:function(){var e=this,t=new Image;ctx.putImageData(saveImg,0,0);var s=canvas.toDataURL("image/png");t.src=s,t.onload=function(){modules.ImgWarper&&(e.$props().warper=new modules.ImgWarper.PointDefiner(canvas,t,saveImg,(function(){drawArea(e.stateProperties.commonProps.area_1,e.stateProperties.commonProps.isEndArea_1,3,colorAdditionalArea)})))},this.$methods().renderAll(!1,{drawAreaPoints:!1})}},eventEmiters:{"emiter-create-sprite":{prop:""},"emiter-keydown":{prop:"key"},"emiter-keyup":{prop:"key"},"emiter-mousemove-canvas":{prop:["x","y"]},"emiter-mousedown-canvas":{prop:["x","y"]},"emiter-mouseup-canvas":{prop:["x","y"]},"emiter-mousewheel-canvas":{prop:0},"emiter-operation-with":{prop:"common",behavior:function(){this.$props().operationWith=this.prop}}}};function getFi(e,t){return 180*Math.atan2(t[1]-e[1],t[0]-e[0])/Math.PI-90}