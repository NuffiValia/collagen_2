function Tile(t,i,e){this.type="tile",this.id=t,this.parent=i.id,this.frame=i.frame,this.frame_collection=i.frame_collection,this.frame_index=i.frame_index,this.point=e.slice(0),this.point2=i.point2.slice(0),this.rotate=i.rotate,this.show=!0,this.scale_x=i.scale_x,this.scale_y=i.scale_x,this.width=i.width,this.height=i.height}function renderAllTiles(){for(var t=0;t<tiles_bg.length;t++)tiles_bg[t].render_();for(t=0;t<tiles_common.length;t++)tiles_common[t].render_()}function animationLopLayer(t,i,e,s){var h={isOff:!1};let n=performance.now();return function s(){var r=performance.now();if(r-n>e){ctx.translate(0,0),ctx.fillRect(0,0,srcWidth,srcHeight),i.sort(o),ctx.save(),ctx.translate(ctxTranslate[0],ctxTranslate[1]),n=r;for(var a=0;a<t.length;a++)t[a].render_();for(a=0;a<i.length;a++)i[a].render_()}ctx.restore(),h.isOff||requestAnimationFrame(s)}(),h;function o(t,i){return t.point[1]+t.height>i.point[1]+i.height?1:t.point[1]+t.height==i.point[1]+i.height?0:t.point[1]+t.height<i.point[1]+i.height?-1:void 0}}function updateCommonTiles(t){tiles_common=[];for(var i=0;i<tiles_common_save.length;i++)t[tiles_common_save[i].parent]&&tiles_common.push(new Tile(tiles_common_save[i].id,t[tiles_common_save[i].parent],tiles_common_save[i].point))}function updateBgTiles(t){tiles_bg=[];for(var i=0;i<tiles_bg_save.length;i++)t[tiles_bg_save[i].parent]&&tiles_bg.push(new Tile(tiles_bg_save[i].id,t[tiles_bg_save[i].parent],tiles_bg_save[i].point))}function updateCollisionTiles(){tiles_collision=[];for(var t=0;t<tiles_collision_save.length;t++)tiles_collision.push(tiles_collision_save[t])}function collisionDetection(t,i){for(var e=!1,s=0;s<t.length;s++){var h=getDistance(t[s].point,i.point);if(Math.abs(h[0])<t[s].width+i.width&&Math.abs(h[1])<t[s].height+i.height){var n=i.point.slice(0);n[1]=n[1]+.8*i.height;var o=.2*i.height;n[0]=n[0]+.3*i.width;var r=.4*i.width,a=t[s].point.slice(0),l=t[s].width,c=t[s].height;n[0]>a[0]&&n[0]<a[0]+l&&n[1]>a[1]&&n[1]<a[1]+c?e=[n[0],n[1]]:n[0]>a[0]&&n[0]<a[0]+l&&n[1]+o>a[1]&&n[1]+o<a[1]+c?e=[n[0],n[1]+o]:n[0]+r>a[0]&&n[0]+r<a[0]+l&&n[1]+o>a[1]&&n[1]+o<a[1]+c?e=[n[0]+r,n[1]+o]:n[0]+r>a[0]&&n[0]+r<a[0]+l&&n[1]>a[1]&&n[1]<a[1]+c&&(e=[n[0]+r,n[1]])}}return e}Tile.prototype.render_=function(){if(this.show)if(0!==this.rotate){var t=this.width/2,i=this.height/2,e=[this.point[0]+t,this.point[1]+i];ctx.save(),ctx.translate(e[0],e[1]),ctx.rotate(this.rotate),ctx.drawImage(this.frame,-t,-i,this.width,this.height),ctx.restore()}else ctx.drawImage(this.frame,this.point[0],this.point[1],this.width,this.height)},Tile.prototype.nextFrame=function(t){this.frame_index+=1,(t||0===t)&&(this.frame_index=t),this.frame_index>this.frame_collection.length-1&&(this.frame_index=0),this.frame=this.frame_collection[this.frame_index]},Tile.prototype.prevFrame=function(t){this.frame_index-=1,(t||0===t)&&(this.frame_index=t),this.frame_index<0&&(this.frame_index=this.frame_collection.length-1),this.frame=this.frame_collection[this.frame_index]},Tile.prototype.move=function(t,i){this.point[0]+=t,this.point[1]+=i},Tile.prototype.moveConer=function(t,i,e){this.point[0]=t,e?this.y=i-this.height:this.point[1]=i},Tile.prototype.moveCenter=function(t,i){this.point[0]=t-this.width/2,this.point[1]=i-this.height/2},Tile.prototype.rotateFi=function(t){this.rotate=parseInt(t)*Math.PI/180},Tile.prototype.scale=function(t,i){if(t!=this.scale_x||i!=this.scale_y){var e=t/this.scale_x,s=i/this.scale_y,h=scaleArea([[this.point[0],this.point[1]],[this.point[0]+this.width,this.point[1]],[this.point[0]+this.width,this.point[1]+this.height],[this.point[0],this.point[1]+this.height]],e,s,!1),n=getBox(h);this.point=n[0],this.point2=n[1],this.width=this.point2[0]-this.point[0],this.height=this.point2[1]-this.point[1],this.scale_x=t,this.scale_y=i}};