function startImg(){var t=document.getElementsByClassName("canvas-container")[0].clientWidth,e=document.getElementsByClassName("canvas-container")[0].clientHeight;littleCanvas&&t>img.width*mainImgScale_x&&(t=img.width*mainImgScale_x),littleCanvas&&e>img.width*mainImgScale_y&&(e=img.height*mainImgScale_y),document.getElementsByClassName("canvas-container")[0].setAttribute("style",""),canvas.setAttribute("style","width:"+Math.round(t)+"px; height: "+Math.round(e)+"px;"),srcWidth=canvas.clientWidth,srcHeight=canvas.clientHeight,canvas.width=srcWidth,canvas.height=srcHeight,(img.width*mainImgScale_x>t||img.height*mainImgScale_y>e)&&(img.width*mainImgScale_x>t&&img.height*mainImgScale_y>e?document.getElementsByClassName("canvas-container")[0].setAttribute("style","overflow: scroll"):img.height*mainImgScale_y>e?document.getElementsByClassName("canvas-container")[0].setAttribute("style","overflow-y: scroll"):img.width*mainImgScale_x>t&&document.getElementsByClassName("canvas-container")[0].setAttribute("style","overflow-x: scroll"),canvas.setAttribute("style","width:"+Math.round(img.width*mainImgScale_x)+"px; height: "+Math.round(img.height*mainImgScale_y)+"px;"),srcWidth=Math.round(canvas.clientWidth),srcHeight=Math.round(canvas.clientHeight),canvas.width=srcWidth,canvas.height=srcHeight),ctx.clearRect(0,0,srcWidth,srcHeight),ctx.save(),-1==mirror_x&&(ctx.translate(srcWidth,0),ctx.scale(mirror_x,1)),-1==mirror_y&&(ctx.translate(0,srcHeight),ctx.scale(1,mirror_y)),img.width*mainImgScale_x>t||img.height*mainImgScale_y>e?ctx.drawImage(img,0,0,srcWidth,srcHeight):ctx.drawImage(img,0,0,img.width*mainImgScale_x,img.height*mainImgScale_y),saveImg=ctx.getImageData(0,0,srcWidth,srcHeight),ctx.restore()}function getBase64Image(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),e.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,"")}function save_in_storage(t,e){var a=JSON.stringify(t);localStorage.setItem(e,a)}function get_from_storage(t,e){var a=localStorage.getItem(t),n=JSON.parse(a);return e?n[e]:n}function loadModul(t,e,a,n,i){if("#"!=t[0]&&(null==n||!1===n||null==onloadModules[n])){var c=document.createElement("script"),r=document.head||document.getElementsByTagName("head")[0];c.type="text/javascript",c.src=t,r.appendChild(c),c.onload=function(){!1!==a&&console.log("модуль "+e+" загружен",t),null!=i&&i()},c.onerror=function(){alert("модуль "+e+" не найден "+t)}}}function loadStyles(t){if("#"!=t[0]){var e=document.createElement("link"),a=document.head||document.getElementsByTagName("head")[0];e.href=t,e.rel="stylesheet",e.onerror=function(){alert("ошибка подкдючения стилей: "+t+"  убедитесь в правильности url")},a.appendChild(e)}}function preloadFonts(t,e){if(!e){var a=document.createElement("canvas");a.width=50,a.height=50,e=a.getContext("2d")}var n=t.match(/(family=)(\w+)(\+?)(\w*)/g),i=[],c=0;if(Array.isArray(n))for(var r=0;r<n.length;r++){var s=n[r].replace(/(family=)(\w+)(\+?)(\w*)/g,"$2 $4").replace(/(\w+)(\s)(?!(\w)+)/,"$1");i.push(s);var l=new Image;l.src=t,l.onerror=function(){e.font="15px "+i[c],c++,e.fillText("Hello!",20,10)}}}function saveStep(t,e){stepBack.push([t,e.slice(0)]),stepBack.length>backStepCounts&&stepBack.shift()}function download(t,e){var a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),a.setAttribute("download",t),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}function record(t,e){var a=[];return new Promise((function(t,n){e.start(),e.ondataavailable=function(t){a.push(t.data)},e.onstop=function(e){var n=new Blob(a,{type:"video/webm"}),i=URL.createObjectURL(n);t(i)}}))}